scale_x_continuous(breaks = c(6, 12, 18, 24)) +
labs(y = NULL, x = "Time of Day",
caption = "November 27, 2018 11:00am to December 4, 2018 1:00pm",
colour = NULL, title = "Google Trends Popularity of 'porn' or 'sex' over a Week in Jordan", subtitle = "Most Hits Occur in the Evening Hours")
ggplot() + geom_line(data = yearly, aes(x = date, y = hits, colour = keyword)) +
geom_rect(data = ramadan_dates, aes(xmin=start, xmax=end, ymin=-Inf, ymax=+Inf), alpha = 0.2) + geom_area(aes(y = ..count.., fill = keyword, group = keyword))
ggplot() + geom_line(data = yearly, aes(x = date, y = hits, colour = keyword)) +
geom_rect(data = ramadan_dates, aes(xmin=start, xmax=end, ymin=-Inf, ymax=+Inf), alpha = 0.2) + geom_area(yearly, aes(y = ..count.., fill = keyword, group = keyword))
ggplot() + geom_line(data = yearly, aes(x = date, y = hits, colour = keyword)) +
geom_rect(data = ramadan_dates, aes(xmin=start, xmax=end, ymin=-Inf, ymax=+Inf), alpha = 0.2) + geom_area(yearly, aes(fill = keyword))
ggplot() + geom_line(data = yearly, aes(x = date, y = hits, colour = keyword)) + geom_area(aes(fill = keyword, group = keyword))
ggplot() + geom_line(data = yearly, aes(x = date, y = hits, colour = keyword)) + geom_area(yearly, aes(fill = keyword, group = keyword)
ggplot() + geom_line(data = yearly, aes(x = date, y = hits, colour = keyword)) + geom_area(yearly, aes(fill = keyword, group = keyword)) +
ggplot() + geom_line(data = yearly, aes(x = date, y = hits, colour = keyword)) + geom_area(yearly, aes(fill = keyword, group = keyword)) + geom_rect(data = ramadan_dates, aes(xmin=start, xmax=end, ymin=-Inf, ymax=+Inf), alpha = 0.2)
ggplot() + geom_line(data = yearly, aes(x = date, y = hits, colour = keyword)) + geom_rect(data = ramadan_dates, aes(xmin=start, xmax=end, ymin=-Inf, ymax=+Inf), alpha = 0.2)
ggplot() + geom_line(data = yearly, aes(x = date, y = hits, colour = keyword)) + geom_rect(data = ramadan_dates, aes(xmin=start, xmax=end, ymin=-Inf, ymax=+Inf), alpha = 0.2) +labs(title="'Porn' and 'Sex' Search Values over the Past 5 Years", subtitle = "Values Exhibit a Strong Decrease Over Ramadan",  x ="Weeks from 2013-2018", y = "Hit Values", caption = "Data Drawn from Only Saudi Arabia and Jordan for Easy Viewing")
hourly2$interest_over_time %>%
mutate(day = lubridate::wday(date, label = TRUE), hour = lubridate::hour(date)) %>%
ggplot() +
geom_line(aes(x = hour, y = hits, colour = keyword)) +
geom_smooth(aes(x = hour, y = hits), se = FALSE) +
facet_grid(. ~ day) +
theme_bw() +
theme(legend.position = 'top') +
scale_x_continuous(breaks = c(6, 12, 18, 24)) +
labs(y = NULL, x = "Time of Day",
caption = "November 27, 2018 11:00am to December 4, 2018 1:00pm",
colour = NULL, subtitle = "Google Trends Popularity of 'porn' or 'sex' over a Week in Jordan", title = "Most Hits Occur in the Evening Hours"
hourly2$interest_over_time %>%
hourly2$interest_over_time %>%
mutate(day = lubridate::wday(date, label = TRUE), hour = lubridate::hour(date)) %>%
ggplot() +
geom_line(aes(x = hour, y = hits, colour = keyword)) +
geom_smooth(aes(x = hour, y = hits), se = FALSE) +
facet_grid(. ~ day) +
theme_bw() +
theme(legend.position = 'top') +
scale_x_continuous(breaks = c(6, 12, 18, 24)) +
labs(y = NULL, x = "Time of Day",
caption = "November 27, 2018 11:00am to December 4, 2018 1:00pm",
colour = NULL, title = "Google Trends Popularity of 'porn' or 'sex' over a Week in Jordan", subtitle = "Most Hits Occur in the Evening Hours")
my_theme <- function() {
theme_bw() +
theme(panel.background = element_blank()) +
theme(plot.background = element_rect(fill = "seashell")) +
theme(panel.border = element_blank()) +                     # facet border
theme(strip.background = element_blank()) +                 # facet title background
theme(plot.margin = unit(c(.5, .5, .5, .5), "cm")) +
theme(panel.spacing = unit(3, "lines")) +
theme(panel.grid.major = element_blank()) +
theme(panel.grid.minor = element_blank()) +
theme(legend.background = element_blank()) +
theme(legend.key = element_blank()) +
theme(legend.title = element_blank())
}
ggplot() + geom_line(data = yearly, aes(x = date, y = hits, colour = keyword)) + geom_rect(data = ramadan_dates, aes(xmin=start, xmax=end, ymin=-Inf, ymax=+Inf), alpha = 0.2) +labs(title="'Porn' and 'Sex' Search Values over the Past 5 Years", subtitle = "Sex and porn related searches decrease Over Ramadan",  x ="Weeks from 2013-2018", y = "Hit Values", caption = "Data Drawn from Only Saudi Arabia and Jordan for Easy Viewing") + my_theme()
graph %>%
select(-days_in_ram, -days_in_eid, -in_ram,- before2_ram, -in_eid, days_before, -category, -before_ram, days_before) %>%
stargazer(type = "html", title="Descriptive statistics", digits=1, flip = TRUE, summary.logical= FALSE)
graph %>%
select(-days_in_ram, -days_in_eid, -in_ram,- before2_ram, -in_eid, days_before, -category, -before_ram, days_before) %>%
stargazer(type = "text", title="Descriptive statistics", digits=1, flip = TRUE, summary.logical= FALSE)
regress1 <- stargazer(ma, mb, m1, m2, m3, m4, summary = FALSE, type = "text", title = "Changes in Sex and Porn Related Search Values Over Ramadan", dep.var.labels = "Mean values for 'sex' and 'porn' hits by Week",  covariate.labels = c("Days in Ram", "Presence of Ram (0 or 1)", "Presence of Eid (0 or 1)"))
stargazer(ma, mb, m1, m2, m3, m4, summary = FALSE, type = "text", title = "Changes in Sex and Porn Related Search Values Over Ramadan", dep.var.labels = "Mean values for 'sex' and 'porn' hits by Week")
m4 <- lm(sum ~ before2_ram + before_ram + in_ram + in_eid, data = graph)
#use results = asis in the caption to make sure the table prints properly
#final regression code
stargazer(ma, mb, m1, m2, m3, m4, summary = FALSE, type = "text", title = "Changes in Sex and Porn Related Search Values Over Ramadan", dep.var.labels = "Mean values for 'sex' and 'porn' hits by Week")
covariate.labels = c("Days in Ram", "Presence of Ram (0 or 1)", "Presence of Eid (0 or 1)"))
stargazer(ma, mb, m1, m3, m4, summary = FALSE, type = "text", title = "Changes in Sex and Porn Related Search Values Over Ramadan", dep.var.labels = "Mean values for 'sex' and 'porn' hits by Week")
stargazer(ma, mb, m1, m3, summary = FALSE, type = "text", title = "Changes in Sex and Porn Related Search Values Over Ramadan", dep.var.labels = "Mean values for 'sex' and 'porn' hits by Week")
stargazer(ma, mb, m1, m3, summary = FALSE, type = "text", title = "Changes in Sex and Porn Related Search Values Over Ramadan", dep.var.labels = "Mean values for 'sex' and 'porn' hits by Week",covariate.labels = c("Days in Ram", "Week Before Ram (0 or 1)", "Presence of Ram (0 or 1)", "Presence of Eid (0 or 1)"))
install.packages("DT")
library(DT)
datatable(D2$related_queries)
gtrends(keyword = c("sex", "Porn"), geo = c("EG", "SA", "AE","JO", "MA"), time = "today 3-m")
gtrends(keyword = c("sex", "porn"), geo = c("EG", "SA", "AE","JO", "MA"), time = "today 3-m")
D1 <- gtrends(keyword = c("sex", "porn"), geo = c("EG", "AE","JO", "MA"), time = "today 3-m")
datatable(D1$related_queries)
D1$related_queries %>%
select(subject, value, geo) %>%
datatable(container, caption = "A Table of Related Queries")
D1$related_queries %>%
select(subject, value, geo) %>%
datatable(caption = "A Table of Related Queries")
D1$related_queries
D1$related_queries %>%
select(subject, value, geo, keyword) %>%
datatable(caption = "A Table of Related Queries")
D1$related_queries %>%
select(subject, value, geo, keyword) %>%
datatable(caption = "A Table of Related Queries", rownames = FALSE)
D1$related_queries %>%
select(subject, value, geo, keyword) %>%
datatable(caption = "A Table of Related Queries", rownames = FALSE, colnames = c("Correlation Score", "Search", "Country", "Sex or Porn"))
D1$related_queries %>%
select(subject, value, geo, keyword) %>%
datatable(caption = "A Table of Related Queries", rownames = FALSE, colnames = c("Correlation Score", "Related Query", "Country", "Sex/Porn"))
world2 <- world2$interest_over_time %>%
select(hits, date, geo) %>%
transmute(hits_porn = hits, date = date)
world2$interest_over_time
world <- gtrends(keyword = "sex", time = "today+5-y")
world2 <- gtrends(keyword = "porn", time = "today+5-y")
world2 <- world2$interest_over_time %>%
select(hits, date, geo) %>%
transmute(hits_porn = hits, date = date)
world_interest <- world$interest_over_time %>%
rename(hits_sex = hits) %>%
left_join(world2, by = c("date", "geo")) %>%
mutate(sum = (hits_sex + hits_porn)/2)
world2 <- world2$interest_over_time %>%
select(hits, date, geo) %>%
transmute(hits_porn = hits, date = date, geo = geo)
world2 <- gtrends(keyword = "porn", time = "today+5-y")
world2 <- world2$interest_over_time %>%
select(hits, date, geo) %>%
transmute(hits_porn = hits, date = date, geo = geo)
world_interest <- world$interest_over_time %>%
rename(hits_sex = hits) %>%
left_join(world2, by = c("date", "geo")) %>%
mutate(sum = (hits_sex + hits_porn)/2)
View(world_interest)
world_interest$date1 = as.Date(world_interest$date) + 1
world_interest$date2 = as.Date(world_interest$date) + 2
world_interest$date3 = as.Date(world_interest$date) + 3
world_interest$date4 = as.Date(world_interest$date) + 4
world_interest$date5 = as.Date(world_interest$date) + 5
world_interest$date6 = as.Date(world_interest$date) + 6
world_interest$year <- substring(world_interest$date,1,4)
#For loop to create (1) a "days_in_ram" variable ->  the number of days in a given week with ramadan present and also (2) "in_ram" variable -> (0 or 1) whether or not ramadan is present in that week
#first iterate over a week in a given year in the D1_interests data set to see if there are any matches for Ramadan occuring
#count the number of days of a given week in teh D1_interest$date variable which overlap with ramadan
#create a binary variable to code 1 if a week includes more than 3 days of ramadan.
for (i in 1:length(world_interest$date)) {
world_interest[i, "days_in_ram"] = 0
for( j in c("date" , "date1", "date2" , "date3", "date4", "date5", "date6")){
if ( (world_interest[i, j] > ramadan_dates[ramadan_dates$year==   world_interest[i, "year"]   &  ramadan_dates$Holiday == "Ramadan" , ]$start  ) & (world_interest[i, j] < ramadan_dates[ramadan_dates$year== world_interest[i,"year"] & ramadan_dates$Holiday == "Ramadan" ,]$end  ) ) {
world_interest[i, "days_in_ram"] =   world_interest[i, "days_in_ram"]  + 1
}
}
if (world_interest[i, "days_in_ram"] > 2){
world_interest[i,"in_ram"] = 1
} else{
world_interest[i,"in_ram"] = 0
}
}
ramadan_dates <- read_excel("ramadan_dates.xlsx")
for (i in 1:length(world_interest$date)) {
world_interest[i, "days_in_ram"] = 0
for( j in c("date" , "date1", "date2" , "date3", "date4", "date5", "date6")){
if ( (world_interest[i, j] > ramadan_dates[ramadan_dates$year==   world_interest[i, "year"]   &  ramadan_dates$Holiday == "Ramadan" , ]$start  ) & (world_interest[i, j] < ramadan_dates[ramadan_dates$year== world_interest[i,"year"] & ramadan_dates$Holiday == "Ramadan" ,]$end  ) ) {
world_interest[i, "days_in_ram"] =   world_interest[i, "days_in_ram"]  + 1
}
}
if (world_interest[i, "days_in_ram"] > 2){
world_interest[i,"in_ram"] = 1
} else{
world_interest[i,"in_ram"] = 0
}
}
#same code as above - Eid al-fitr: days_in_eid
for (i in 1:length(world_interest$date)) {
world_interest[i, "days_in_eid"] = 0
for( j in c("date" , "date1", "date2" , "date3", "date4", "date5", "date6")){
if ( (D1_interest[i, j] >= ramadan_dates[ramadan_dates$year==   D1_interest[i, "year"]   &  ramadan_dates$Holiday ==  "Eid al-Fitr" , ]$start  ) & (D1_interest[i, j] <=  ramadan_dates[ramadan_dates$year== world_interest[i,"year"] & ramadan_dates$Holiday ==  "Eid al-Fitr" ,]$end  ) ) {
world_interest[i, "days_in_eid"] =   world_interest[i, "days_in_eid"]  + 1
}
}
if (D1_interest[i, "days_in_eid"] > 2){
D1_interest[i,"in_eid"] = 1
} else{
D1_interest[i,"in_eid"] = 0
}
}
#code for the week before ramadan
for (i in 1:length(world_interest$date)) {
D1_interest[i, "days_before"] = 0
for( j in c("date" , "date1", "date2" , "date3", "date4", "date5", "date6")){
if ( (D1_interest[i, j] >= ramadan_dates[ramadan_dates$year==   D1_interest[i, "year"]   &  ramadan_dates$Holiday == "Ramadan" , ]$start  ) & (D1_interest[i, j] <= ramadan_dates[ramadan_dates$year== D1_interest[i,"year"] & ramadan_dates$Holiday == "Ramadan" ,]$end  ) ) {
D1_interest[i, "days_in_ram"] =   D1_interest[i, "days_in_ram"]  + 1
}
}
if (D1_interest[i, "days_in_ram"] > 2){
D1_interest[i,"in_ram"] = 1
} else{
D1_interest[i,"in_ram"] = 0
}
}
glimpse(world_interest)
write_rds(world_interest, "world.rds")
library(ls)
knitr::opts_chunk$set(echo = TRUE)
library(stargazer)
library(gtrendsR)
library(tidyverse)
library(knitr)
library(readxl)
library(DT)
world <- read_rds("world.rds")
w1 <- lm(sum ~ in_ram, data=world)
w2 <- lm(sum ~ in_ram + in_eid, data=world)
View(world)
w1 <- lm(sum ~ in_ram, data=world)
stargazer(w1, summary = FALSE, type = "text", title = "Global Level Changes in Sex and Porn Related Search Values Over Ramadan", dep.var.labels = "Mean values for 'sex' and 'porn' hits by Week",covariate.labels = "Presence of Ram (0 or 1)")
summary(lm(sum ~ in_ram + in_eid+ factor(geo) -1 + factor(year) - 1, data=panel))
panel <- read_rds("D1_interest.rds")
summary(lm(sum ~ in_ram + in_eid+ factor(geo) -1 + factor(year) - 1, data=panel))
library(foreign)
library(tidyverse)
library(car)
summary(lm(sum ~ in_ram + in_eid+ factor(geo) -1 + factor(year) - 1, data=panel))
panel <- read_rds("D1_interest.rds")
summary(lm(sum ~ in_ram + in_eid+ factor(geo) -1 + factor(year) - 1, data=panel))
summary(plm(sum ~ in_ram, data=panel, index=c("geo", "year"), model="within"))
library(plm)
summary(plm(sum ~ in_ram, data=panel, index=c("geo", "year"), model="within"))
stargazer(save, "text")
library(stargazer)
stargazer(save, "text")
knitr::opts_chunk$set(echo = TRUE)
library(stargazer)
library(gtrendsR)
library(tidyverse)
library(knitr)
library(readxl)
#library(ls)
#grabbing data for EG, SA, JO, MA
grab1 <- gtrends(keyword = c("sex"), geo = c("EG", "SA", "AE","JO", "MA"), time = "today+5-y")$interest_over_time
grab2 <- gtrends(keyword = c("porn"), geo = c("EG", "SA", "AE","JO", "MA"), time = "today+5-y")$interest_over_time
#merging grabbed data and averaging porn search terms for grabs 1 and 2
grab2 <- grab2 %>%
select(hits, date, geo) %>%
transmute(hits.porn = hits, date = date, geo = geo)
grab1 <- grab1 %>%
rename(hits.sex = hits) %>%
left_join(grab2, by = c("date", "geo")) %>%
mutate(sum = (hits.sex + hits.porn)/2)
rm(grab2)
#we're left with grab 1!
#gabbing data for Iran, Afghanistan,
#first term is same across countries
grab3 <- gtrends(keyword = c("سکس"), geo = c("IR", "AF"), time = "today+5-y")$interest_over_time
grab4 <- gtrends(keyword = c("sex"), geo = c("IR", "AF"), time = "today+5-y")$interest_over_time
#merging grabbed data and averaging porn search terms for grabs 3 and 4
#renaming the sks term to hits.porn for the purpose of binding rows
grab3 <- grab3 %>%
select(hits, date, geo) %>%
transmute(hits.porn = hits, date = date, geo = geo)
grab4 <- grab4 %>%
rename(hits.sex = hits) %>%
left_join(grab3, by = c("date", "geo")) %>%
mutate(sum = (hits.sex + hits.porn)/2)
rm(grab3)
#we're left with grab 4!
#grabbing data for Turkey, Pakistan
grab5 <- gtrends(keyword = c("sex"), geo = c("PK", "TR", "TN", "LY"), time = "today+5-y")$interest_over_time
grab6 <- gtrends(keyword = c("porn"), geo = c("PK", "TR", "TN", "LY"), time = "today+5-y")$interest_over_time
grab5 <- grab5 %>%
select(hits, date, geo) %>%
transmute(hits.sex = hits, date = date, geo = geo)
grab6 <- grab6 %>%
rename(hits.porn = hits) %>%
left_join(grab5, by = c("date", "geo")) %>%
mutate(sum = (hits.sex + hits.porn)/2)
#we're left with grab 6
rm(grab5)
#bind rows from grabbed frames and label it D1_interest
D1_interest <- bind_rows(grab1, grab4, grab6)
D1_interest$date1 = as.Date(D1_interest$date) + 1
D1_interest$date2 = as.Date(D1_interest$date) + 2
D1_interest$date3 = as.Date(D1_interest$date) + 3
D1_interest$date4 = as.Date(D1_interest$date) + 4
D1_interest$date5 = as.Date(D1_interest$date) + 5
D1_interest$date6 = as.Date(D1_interest$date) + 6
D1_interest$year <- substring(D1_interest$date,1,4)
#For loop to create (1) a "days_in_ram" variable ->  the number of days in a given week with ramadan present and also (2) "in_ram" variable -> (0 or 1) whether or not ramadan is present in that week
#first iterate over a week in a given year in the D1_interests data set to see if there are any matches for Ramadan occuring
#count the number of days of a given week in teh D1_interest$date variable which overlap with ramadan
#create a binary variable to code 1 if a week includes more than 3 days of ramadan.
for (i in 1:length(D1_interest$date)) {
D1_interest[i, "days_in_ram"] = 0
for( j in c("date" , "date1", "date2" , "date3", "date4", "date5", "date6")){
if ( (D1_interest[i, j] >= ramadan_dates[ramadan_dates$year==   D1_interest[i, "year"]   &  ramadan_dates$Holiday == "Ramadan" , ]$start  ) & (D1_interest[i, j] <= ramadan_dates[ramadan_dates$year== D1_interest[i,"year"] & ramadan_dates$Holiday == "Ramadan" ,]$end  ) ) {
D1_interest[i, "days_in_ram"] =   D1_interest[i, "days_in_ram"]  + 1
}
}
if (D1_interest[i, "days_in_ram"] > 2){
D1_interest[i,"in_ram"] = 1
} else{
D1_interest[i,"in_ram"] = 0
}
}
#code variable for the week before ramadan to test whether the week before ramadan results in a change in values
D1_interest$before_ram = 0
for (i in 1:length(D1_interest$date) - 1) {
if (D1_interest$in_ram == 0 & D1_interest$in_ram[i +1] == 1) D1_interest$before_ram[i] = 1 else D1_interest$before_ram[i] <- 0
}
#code variable for the week before ramadan to test whether 2 weeks before ramadan results in a change in values
D1_interest$before2_ram = 0
for (i in 1:length(D1_interest$date) - 2) {
if (D1_interest$in_ram == 0 & D1_interest$in_ram[i +2] == 1) D1_interest$before2_ram[i] = 1 else D1_interest$before2_ram[i] <- 0
}
#Thank you to Eric Wasserman Harvard 2019 Dunster House for helping me conceptualize how best to approach the coding problem above!
#my next step in data manipulation before running a regression will be to add an additional variable for year so that I can control #for that.
#I also may go back up (before doing the ramadan stuff) and create a combined variable of porn searches called porn which is the #average of the high volume porn searches I've found
#repeat the ramadan iteration but this time for celebratory holidays
#first I'll manipulate the ramadan_dates to code "celebratory holiday for Eid""
#code variable for celebratory holidays, same method as ramadan
for (i in 1:length(D1_interest$date)) {
D1_interest[i, "days_in_eid"] = 0
for( j in c("date" , "date1", "date2" , "date3", "date4", "date5", "date6")){
if ( (D1_interest[i, j] >= ramadan_dates[ramadan_dates$year==   D1_interest[i, "year"]   &  ramadan_dates$Holiday ==  "Eid al-Fitr" , ]$start  ) & (D1_interest[i, j] <=  ramadan_dates[ramadan_dates$year== D1_interest[i,"year"] & ramadan_dates$Holiday ==  "Eid al-Fitr" ,]$end  ) ) {
D1_interest[i, "days_in_eid"] =   D1_interest[i, "days_in_eid"]  + 1
}
}
if (D1_interest[i, "days_in_eid"] > 2){
D1_interest[i,"in_eid"] = 1
} else{
D1_interest[i,"in_eid"] = 0
}
}
for (i in 1:length(D1_interest$date)) {
D1_interest[i, "days_before"] = 0
for( j in c("date" , "date1", "date2" , "date3", "date4", "date5", "date6")){
if ( (D1_interest[i, j] >= ramadan_dates[ramadan_dates$year==   D1_interest[i, "year"]   &  ramadan_dates$Holiday == "Ramadan" , ]$start  ) & (D1_interest[i, j] <= ramadan_dates[ramadan_dates$year== D1_interest[i,"year"] & ramadan_dates$Holiday == "Ramadan" ,]$end  ) ) {
D1_interest[i, "days_in_ram"] =   D1_interest[i, "days_in_ram"]  + 1
}
}
if (D1_interest[i, "days_in_ram"] > 2){
D1_interest[i,"in_ram"] = 1
} else{
D1_interest[i,"in_ram"] = 0
}
}
write_rds(D1_interest, "D1_interest.rds")
D1_interest %>%
select(-days_in_ram, -days_in_eid, -in_ram,- before2_ram, -in_eid, days_before, -category, -before_ram, days_before) %>%
stargazer(type = "html", title="Descriptive statistics", digits=1, flip = TRUE, summary.logical= FALSE)
D1_interest %>%
select(-days_in_ram, -days_in_eid, -in_ram,- before2_ram, -in_eid, days_before, -category, -before_ram, days_before) %>%
stargazer(type = "text", title="Descriptive statistics", digits=1, flip = TRUE, summary.logical= FALSE)
View(D1_interest)
knitr::opts_chunk$set(echo = TRUE)
library(stargazer)
library(gtrendsR)
library(tidyverse)
library(knitr)
library(readxl)
library(DT)
graph <- read_rds("D1_interest.rds") %>%
select(-keyword, -date1, -date2, -date3, -date4, -date5, -date6)
grpah
graph
graph1 <- graph %>%
mutate(hits = hits.porn,
category = "porn") %>%
select(hits, category, date, in_ram)
graph2 <- graph %>%
mutate(hits = hits.sex,
category = "sex") %>%
select(hits, category, date, in_ram)
graph3 <- bind_rows(graph1, graph2)
ramadan_dates <- read_excel("ramadan_dates.xlsx") %>%
filter(year >= 2014, Holiday == "Ramadan")
ggplot() + geom_line(data = graph3, aes(x = date, y = hits, colour = category))+ geom_rect(data= ramadan_dates, aes(xmin=start, xmax=end, ymin=-Inf, ymax=+Inf), alpha = 0.2) + labs(title="'Porn' and 'Sex' Search Values over the Past 5 Years", subtitle = "Values Exhibit a Strong Decrease Over Ramadan", x ="Weeks from 2013-2018", y = "Hit Values", caption = "Data Drawn from SA, JO, EG, MA, UAE")
ggplot() + geom_line(data = graph3, aes(x = date, y = hits, colour = category))+ geom_rect(data= ramadan_dates, aes(xmin=start, xmax=end, ymin=-Inf, ymax=+Inf), alpha = 0.2) + labs(title="'Porn' and 'Sex' Search Values over the Past 5 Years", subtitle = "Values Exhibit a Strong Decrease Over Ramadan", x ="Weeks from 2013-2018", y = "Hit Values", caption = "Data Drawn from SA, JO, EG, MA, UAE")
knitr::opts_chunk$set(echo = TRUE)
library(stargazer)
library(gtrendsR)
library(tidyverse)
library(knitr)
library(readxl)
library(DT)
ggplot(D1_interest, aes(sum, geo)) +
geom_line(aes(group = geo)) +
geom_point(aes(color = in_ram))
D1_interest$in_ram
ggplot(D1_interest, aes(sum, geo)) +
geom_line(aes(group = geo)) +
geom_point(aes(color = days_in_ram))
D1_interest$days_in_ram
View(D1_interest)
knitr::opts_chunk$set(echo = TRUE)
library(stargazer)
library(gtrendsR)
library(tidyverse)
library(knitr)
library(readxl)
#library(ls)
D1_interest <- bind_rows(grab1, grab4, grab6)
D1_interest$date1 = as.Date(D1_interest$date) + 1
D1_interest$date2 = as.Date(D1_interest$date) + 2
D1_interest$date3 = as.Date(D1_interest$date) + 3
D1_interest$date4 = as.Date(D1_interest$date) + 4
D1_interest$date5 = as.Date(D1_interest$date) + 5
D1_interest$date6 = as.Date(D1_interest$date) + 6
D1_interest$year <- substring(D1_interest$date,1,4)
for (i in 1:length(D1_interest$date)) {
D1_interest[i, "days_in_ram"] = 0
for( j in c("date" , "date1", "date2" , "date3", "date4", "date5", "date6")){
if ( (D1_interest[i, j] >= ramadan_dates[ramadan_dates$year==   D1_interest[i, "year"]   &  ramadan_dates$Holiday == "Ramadan" , ]$start  ) & (D1_interest[i, j] <= ramadan_dates[ramadan_dates$year== D1_interest[i,"year"] & ramadan_dates$Holiday == "Ramadan" ,]$end  ) ) {
D1_interest[i, "days_in_ram"] =   D1_interest[i, "days_in_ram"]  + 1
}
}
if (D1_interest[i, "days_in_ram"] > 2){
D1_interest[i,"in_ram"] = 1
} else{
D1_interest[i,"in_ram"] = 0
}
}
D1_interest$date1 = as.Date(D1_interest$date) + 1
D1_interest$date2 = as.Date(D1_interest$date) + 2
D1_interest$date3 = as.Date(D1_interest$date) + 3
D1_interest$date4 = as.Date(D1_interest$date) + 4
D1_interest$date5 = as.Date(D1_interest$date) + 5
D1_interest$date6 = as.Date(D1_interest$date) + 6
D1_interest$year <- substring(D1_interest$date,1,4)
for (i in 1:length(D1_interest$date)) {
D1_interest[i, "days_in_ram"] = 0
for( j in c("date" , "date1", "date2" , "date3", "date4", "date5", "date6")){
if ( (D1_interest[i, j] >= ramadan_dates[ramadan_dates$year==   D1_interest[i, "year"]   &  ramadan_dates$Holiday == "Ramadan" , ]$start  ) & (D1_interest[i, j] <= ramadan_dates[ramadan_dates$year== D1_interest[i,"year"] & ramadan_dates$Holiday == "Ramadan" ,]$end  ) ) {
D1_interest[i, "days_in_ram"] =   D1_interest[i, "days_in_ram"]  + 1
}
}
if (D1_interest[i, "days_in_ram"] > 2){
D1_interest[i,"in_ram"] = 1
} else{
D1_interest[i,"in_ram"] = 0
}
}
ramadan_dates <- read_excel("ramadan_dates.xlsx")
D1_interest$date1 = as.Date(D1_interest$date) + 1
D1_interest$date2 = as.Date(D1_interest$date) + 2
D1_interest$date3 = as.Date(D1_interest$date) + 3
D1_interest$date4 = as.Date(D1_interest$date) + 4
D1_interest$date5 = as.Date(D1_interest$date) + 5
D1_interest$date6 = as.Date(D1_interest$date) + 6
D1_interest$year <- substring(D1_interest$date,1,4)
for (i in 1:length(D1_interest$date)) {
D1_interest[i, "days_in_ram"] = 0
for( j in c("date" , "date1", "date2" , "date3", "date4", "date5", "date6")){
if ( (D1_interest[i, j] >= ramadan_dates[ramadan_dates$year==   D1_interest[i, "year"]   &  ramadan_dates$Holiday == "Ramadan" , ]$start  ) & (D1_interest[i, j] <= ramadan_dates[ramadan_dates$year== D1_interest[i,"year"] & ramadan_dates$Holiday == "Ramadan" ,]$end  ) ) {
D1_interest[i, "days_in_ram"] =   D1_interest[i, "days_in_ram"]  + 1
}
}
if (D1_interest[i, "days_in_ram"] > 2){
D1_interest[i,"in_ram"] = 1
} else{
D1_interest[i,"in_ram"] = 0
}
}
View(D1_interest)
D1_interest$before_ram = 0
for (i in 1:length(D1_interest$date) - 1) {
if (D1_interest$in_ram == 0 & D1_interest$in_ram[i +1] == 1) D1_interest$before_ram[i] = 1 else D1_interest$before_ram[i] <- 0
}
View(D1_interest)
for (i in 1:length(D1_interest$date)) {
D1_interest[i, "days_in_eid"] = 0
for( j in c("date" , "date1", "date2" , "date3", "date4", "date5", "date6")){
if ( (D1_interest[i, j] >= ramadan_dates[ramadan_dates$year==   D1_interest[i, "year"]   &  ramadan_dates$Holiday ==  "Eid al-Fitr" , ]$start  ) & (D1_interest[i, j] <=  ramadan_dates[ramadan_dates$year== D1_interest[i,"year"] & ramadan_dates$Holiday ==  "Eid al-Fitr" ,]$end  ) ) {
D1_interest[i, "days_in_eid"] =   D1_interest[i, "days_in_eid"]  + 1
}
}
if (D1_interest[i, "days_in_eid"] > 2){
D1_interest[i,"in_eid"] = 1
} else{
D1_interest[i,"in_eid"] = 0
}
}
View(D1_interest)
#write an rds file to save the data and graph in presentation
write_rds(D1_interest, "D1_interest.rds")
knitr::opts_chunk$set(echo = TRUE)
library(stargazer)
library(gtrendsR)
library(tidyverse)
library(knitr)
library(readxl)
grab1 <- gtrends(keyword = c("sex"), geo = c("EG", "SA", "AE","JO", "MA"), time = "today+5-y")$interest_over_time
grab2 <- gtrends(keyword = c("porn"), geo = c("EG", "SA", "AE","JO", "MA"), time = "today+5-y")$interest_over_time
grab2 <- grab2 %>%
select(hits, date, geo) %>%
transmute(hits.porn = hits, date = date, geo = geo)
grab1 <- grab1 %>%
rename(hits.sex = hits) %>%
left_join(grab2, by = c("date", "geo")) %>%
mutate(sum = (hits.sex + hits.porn)/2)
rm(grab2)
grab3 <- gtrends(keyword = c("سکس"), geo = c("IR", "AF"), time = "today+5-y")$interest_over_time
grab4 <- gtrends(keyword = c("sex"), geo = c("IR", "AF"), time = "today+5-y")$interest_over_time
grab3 <- grab3 %>%
select(hits, date, geo) %>%
transmute(hits.porn = hits, date = date, geo = geo)
grab4 <- grab4 %>%
rename(hits.sex = hits) %>%
left_join(grab3, by = c("date", "geo")) %>%
mutate(sum = (hits.sex + hits.porn)/2)
rm(grab3)
grab5 <- gtrends(keyword = c("sex"), geo = c("PK", "TR", "TN", "LY"), time = "today+5-y")$interest_over_time
grab6 <- gtrends(keyword = c("porn"), geo = c("PK", "TR", "TN", "LY"), time = "today+5-y")$interest_over_time
grab5 <- gtrends(keyword = c("sex"), geo = c("PK", "TR", "TN", "LY"), time = "today+5-y")$interest_over_time
grab6 <- gtrends(keyword = c("porn"), geo = c("PK", "TR", "TN", "LY"), time = "today+5-y")$interest_over_time
grab5 <- grab5 %>%
select(hits, date, geo) %>%
transmute(hits.sex = hits, date = date, geo = geo)
grab6 <- grab6 %>%
rename(hits.porn = hits) %>%
left_join(grab5, by = c("date", "geo")) %>%
mutate(sum = (hits.sex + hits.porn)/2)
rm(grab5)
